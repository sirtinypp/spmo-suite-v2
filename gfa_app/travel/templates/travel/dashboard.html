<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ dashboard_title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --up-maroon: #7b1113;
            --slate-900: #0f172a;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .hero-pattern {
            background-color: var(--slate-900);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231e293b' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <header class="bg-white border-b border-slate-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="{% url 'index' %}" class="flex items-center gap-4 group">
                    <img src="https://upload.wikimedia.org/wikipedia/en/3/3a/University_of_the_Philippines_Seal.svg"
                        alt="UP Seal" class="w-12 h-12 transition group-hover:scale-105 drop-shadow-sm">
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">SSPMO System</span>
                        <h1 class="text-xl font-bold text-slate-900 leading-none">GFA <span
                                class="text-[#7b1113]">Executive</span></h1>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-6">
                <a href="http://localhost:8000"
                    class="hidden md:flex items-center gap-2 text-sm font-bold text-slate-500 hover:text-[#7b1113] transition">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg> SSPMO Website
                </a>
                <div class="h-6 w-px bg-slate-200 hidden md:block"></div>
                <span class="text-xs font-bold bg-slate-100 px-3 py-1 rounded-full text-slate-600 uppercase">{{
                    user.username }}</span>
                <form action="{% url 'logout' %}" method="post">{% csrf_token %}<button
                        class="text-sm font-medium text-red-600 hover:text-red-800 transition">Logout</button></form>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <div class="hero-pattern h-80 w-full relative">
            <div class="absolute inset-0 bg-gradient-to-r from-[#7b1113] to-slate-900 opacity-90"></div>
            <div class="relative max-w-7xl mx-auto px-4 pt-12 sm:px-6 lg:px-8 flex justify-between items-start h-full">
                <div class="text-white">
                    <h2 class="text-4xl font-bold tracking-tight mb-2">{{ dashboard_title }}</h2>
                    <p class="text-white/80 text-base max-w-2xl">Real-time GFA procurement tracking, budget monitoring,
                        and document review.</p>
                </div>
                <div class="hidden sm:block bg-white/10 backdrop-blur-sm border border-white/10 px-4 py-2 rounded-lg">
                    <div class="text-[10px] text-white/70 font-mono uppercase tracking-wider">System Status</div>
                    <div class="flex items-center gap-2 text-emerald-400 font-semibold text-sm">
                        <span class="relative flex h-2 w-2"><span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span
                                class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span></span>
                        Operational
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-20 relative z-10 pb-12 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div
                    class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-[#7b1113] flex flex-col justify-between h-32 hover:-translate-y-1 transition duration-300">
                    <div class="flex justify-between items-start">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">Total Bookings</p>
                        <div class="p-2 bg-red-50 text-[#7b1113] rounded-lg"><svg class="w-5 h-5" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                                </path>
                            </svg></div>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">{{ total_reqs }}</h3>
                </div>

                <div
                    class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-yellow-500 flex flex-col justify-between h-32 hover:-translate-y-1 transition duration-300">
                    <div class="flex justify-between items-start">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">Pending Action</p>
                        <div class="p-2 bg-yellow-50 text-yellow-600 rounded-lg"><svg class="w-5 h-5" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg></div>
                    </div>
                    <h3 class="text-3xl font-bold text-yellow-600">{{ pending_reqs }}</h3>
                </div>

                <div
                    class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-emerald-700 flex flex-col justify-between h-32 hover:-translate-y-1 transition duration-300">
                    <div>
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">PAL Credit Balance</p>
                        <h3 class="text-2xl font-bold {{ pal_display.color }} mt-2 font-mono tracking-tight">₱ {{
                            pal_display.val }}</h3>
                    </div>
                    <p class="text-xs {{ pal_display.color }} font-medium flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Real-time
                    </p>
                </div>

                <div
                    class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-slate-600 flex flex-col justify-between h-32 hover:-translate-y-1 transition duration-300">
                    <div>
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">CEBUPAC Credit Balance</p>
                        <h3 class="text-2xl font-bold {{ ceb_display.color }} mt-2 font-mono tracking-tight">₱ {{
                            ceb_display.val }}</h3>
                    </div>
                    <p class="text-xs {{ ceb_display.color }} font-medium flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Real-time
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2"><span
                            class="w-2 h-6 bg-[#7b1113] rounded-full"></span> Top Destinations</h3>
                    <div class="relative h-64 w-full"><canvas id="destChart"></canvas></div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2"><span
                            class="w-2 h-6 bg-emerald-700 rounded-full"></span> Requests by Office</h3>
                    <div class="relative h-64 w-full flex justify-center"><canvas id="officeChart"></canvas></div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden mt-8">
                <div class="px-6 py-5 border-b border-slate-200 bg-slate-50 flex justify-between items-center">
                    <h3 class="font-bold text-slate-800">Recent Transactions</h3>
                    <form method="GET" action="" class="flex gap-2">
                        <div class="relative">
                            <input type="text" name="q" value="{{ search_query|default:'' }}"
                                placeholder="Search Ref No or Name..."
                                class="text-xs border rounded px-3 py-1.5 pl-8 focus:ring-2 focus:ring-[#7b1113] outline-none w-64">
                            <svg class="w-3 h-3 text-slate-400 absolute left-2.5 top-2" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <button type="submit"
                            class="bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded text-xs font-bold transition">Search</button>
                    </form>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-slate-50 border-b border-slate-200 text-slate-500 uppercase text-xs font-bold">
                            <tr>
                                <th class="px-6 py-3">Ref</th>
                                <th class="px-6 py-3">Traveler Info</th>
                                <th class="px-6 py-3">Docs</th>
                                <th class="px-6 py-3">Status</th>
                                <th class="px-6 py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-slate-100">
                            {% for t in transactions %}
                            <tr class="hover:bg-slate-50 transition duration-150">
                                <td class="px-6 py-4">
                                    <span
                                        class="font-mono font-bold text-[#7b1113] bg-red-50 px-2 py-1 rounded text-xs">GFA-{{
                                        t.id|stringformat:"06d" }}</span>
                                    <div class="text-[10px] text-slate-400 mt-1">{{ t.created_at|date:"M d, Y" }}</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-bold text-slate-900">{{ t.full_name }}</div>
                                    <div class="text-xs text-slate-500">{{ t.get_unit_office_display }}</div>
                                </td>
                                <td class="px-6 py-4">
                                    {% if t.doc_signed_slip %}
                                    <a href="{{ t.doc_signed_slip.url }}" target="_blank"
                                        class="text-blue-600 hover:underline text-xs font-bold">View Slip</a>
                                    {% else %}
                                    <span class="text-slate-300 text-xs italic">Pending</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4">
                                    <span
                                        class="px-2 py-1 rounded text-[10px] font-bold {% if t.status == 'PENDING' %}bg-yellow-100 text-yellow-700{% elif t.status == 'APPROVED' %}bg-blue-100 text-blue-700{% elif t.status == 'BOOKED' %}bg-emerald-100 text-emerald-700{% else %}bg-slate-100 text-slate-600{% endif %}">{{
                                        t.status }}</span>
                                </td>
                                <td class="px-6 py-4">
                                    {% if t.status == 'PENDING' %}
                                    <form action="{% url 'update_status' t.id %}" method="POST" class="flex gap-2">
                                        {% csrf_token %}
                                        <button name="action" value="approve"
                                            class="bg-emerald-600 text-white text-[10px] font-bold px-3 py-1.5 rounded hover:bg-emerald-700">Approve</button>
                                        <button name="action" value="return"
                                            class="bg-white border text-red-600 text-[10px] font-bold px-3 py-1.5 rounded hover:bg-red-50">Return</button>
                                    </form>
                                    {% elif t.status == 'APPROVED' %}
                                    <a href="{% url 'admin_attach_ticket' t.id %}"
                                        class="bg-blue-600 text-white text-[10px] font-bold px-3 py-1.5 rounded hover:bg-blue-700 flex items-center w-max gap-1">Issue
                                        Ticket</a>
                                    {% else %}
                                    <span class="text-slate-400 text-[10px] italic">Locked</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        const destLabels = JSON.parse('{{ dest_labels|safe }}');
        const destCounts = JSON.parse('{{ dest_counts|safe }}');
        const officeLabels = JSON.parse('{{ office_labels|safe }}');
        const officeCounts = JSON.parse('{{ office_counts|safe }}');

        Chart.defaults.font.family = "'Inter', sans-serif";
        const upColors = ['#7b1113', '#014421', '#f59e0b', '#0f172a', '#991b1b'];

        new Chart(document.getElementById('destChart'), {
            type: 'bar',
            data: { labels: destLabels, datasets: [{ label: 'Flights', data: destCounts, backgroundColor: '#7b1113', borderRadius: 4 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } } }
        });

        new Chart(document.getElementById('officeChart'), {
            type: 'doughnut',
            data: { labels: officeLabels, datasets: [{ data: officeCounts, backgroundColor: upColors, borderWidth: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'right', labels: { usePointStyle: true, padding: 15, font: { size: 10 } } } } }
        });
    </script>
</body>

</html>